FROM node:18

ARG PORT
ENV PORT ${PORT:-80}

ENV NODE_ENV production

ARG DATABASE_HOST
ENV DATABASE_HOST ${DATABASE_HOST}

ARG DATABASE_PORT
ENV DATABASE_PORT ${DATABASE_PORT}

ARG DATABASE_USER
ENV DATABASE_USER ${DATABASE_USER}

ARG DATABASE_PASSWORD
ENV DATABASE_PASSWORD ${DATABASE_PASSWORD}

ARG DATABASE_NAME
ENV DATABASE_NAME ${DATABASE_NAME}

COPY ./package*.json ./
COPY ./dist ./dist
COPY ./check-node.ts ./check-node.ts

WORKDIR /

RUN npm ci --omit=dev

EXPOSE ${PORT}

CMD npm run serve
